<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üçΩÔ∏è SNSÏÑºÌÑ∞ Ï†êÏã¨ Î∞∞Î∂Ñ ÌîÑÎ°úÍ∑∏Îû®</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Pretendard', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: #050510;
            color: #e0e6ed;
            min-height: 100vh;
            overflow-x: hidden;
        }
        
        /* Ìó§Îçî */
        .header {
            background: linear-gradient(135deg, #1e6deb 0%, #0052cc 100%);
            padding: 20px 0;
            box-shadow: 0 4px 20px rgba(30, 109, 235, 0.3);
        }
        
        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .logo-text {
            font-size: 22px;
            font-weight: bold;
            color: white;
            letter-spacing: 1px;
        }
        
        .mode-switch {
            display: flex;
            gap: 10px;
        }
        
        .mode-btn {
            padding: 10px 20px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            background: transparent;
            color: white;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 14px;
            font-weight: 500;
        }
        
        .mode-btn:hover {
            background: rgba(255, 255, 255, 0.1);
        }
        
        .mode-btn.active {
            background: rgba(255, 255, 255, 0.2);
            border-color: white;
        }
        
        /* Î°úÍ∑∏Ïù∏ Î™®Îã¨ */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }
        
        .modal.active {
            display: flex;
        }
        
        .modal-content {
            background: #0f1420;
            padding: 40px;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.8);
            max-width: 400px;
            width: 90%;
        }
        
        .modal-title {
            color: #1e6deb;
            font-size: 24px;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .password-input {
            width: 100%;
            padding: 12px;
            background: #050510;
            border: 2px solid #1a2332;
            border-radius: 8px;
            color: white;
            font-size: 16px;
            margin-bottom: 20px;
        }
        
        .password-input:focus {
            outline: none;
            border-color: #1e6deb;
        }
        
        .modal-buttons {
            display: flex;
            gap: 10px;
        }
        
        .modal-btn {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .modal-btn.confirm {
            background: linear-gradient(135deg, #1e6deb 0%, #0052cc 100%);
            color: white;
        }
        
        .modal-btn.cancel {
            background: #1a2332;
            color: #e0e6ed;
        }
        
        .modal-btn:hover {
            transform: translateY(-2px);
        }
        
        /* Î©îÏù∏ Ïª®ÌÖåÏù¥ÎÑà */
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        /* ÏÇ¨Ïö©Ïûê Ï†ïÎ≥¥ Î∞î */
        .user-info-bar {
            background: #0f1420;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
        }
        
        .my-lunch-time {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .my-lunch-label {
            color: #9ca3af;
            font-size: 14px;
        }
        
        .my-lunch-value {
            background: linear-gradient(135deg, #1e6deb 0%, #0052cc 100%);
            padding: 8px 16px;
            border-radius: 20px;
            color: white;
            font-weight: bold;
            font-size: 16px;
        }
        
        .name-setting {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        
        .name-input {
            padding: 8px 12px;
            background: #050510;
            border: 2px solid #1a2332;
            border-radius: 8px;
            color: white;
            font-size: 14px;
            width: 150px;
        }
        
        .save-name-btn {
            padding: 8px 16px;
            background: #1e6deb;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }
        
        .save-name-btn:hover {
            background: #0052cc;
        }
        
        /* Í¥ÄÎ¶¨Ïûê Ìå®ÎÑê */
        .admin-panel {
            display: none;
            background: #0f1420;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
        }
        
        .admin-panel.active {
            display: block;
        }
        
        .control-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .control-section {
            background: #0a0a1a;
            padding: 20px;
            border-radius: 10px;
            border: 1px solid #1a2332;
        }
        
        .control-section h3 {
            color: #1e6deb;
            margin-bottom: 15px;
            font-size: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-label {
            display: block;
            color: #9ca3af;
            margin-bottom: 5px;
            font-size: 13px;
        }
        
        .form-control {
            width: 100%;
            padding: 10px;
            background: #050510;
            border: 2px solid #1a2332;
            border-radius: 8px;
            color: white;
            font-size: 14px;
        }
        
        .form-control:focus {
            outline: none;
            border-color: #1e6deb;
        }
        
        .add-btn {
            padding: 8px 16px;
            background: #1e6deb;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
            margin-top: 10px;
        }
        
        .add-btn:hover {
            background: #0052cc;
        }
        
        .tag-list {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 10px;
        }
        
        .tag {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 13px;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .vacation-tag {
            background: rgba(239, 68, 68, 0.2);
            color: #ef4444;
            border: 1px solid rgba(239, 68, 68, 0.3);
        }
        
        .pair-tag {
            background: rgba(34, 197, 94, 0.2);
            color: #22c55e;
            border: 1px solid rgba(34, 197, 94, 0.3);
        }
        
        .special-tag {
            background: rgba(251, 191, 36, 0.2);
            color: #fbbf24;
            border: 1px solid rgba(251, 191, 36, 0.3);
        }
        
        /* Í≤ÄÏÉâ Ï†úÏïà */
        .search-suggestions {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: #050510;
            border: 2px solid #1a2332;
            border-top: none;
            border-radius: 0 0 8px 8px;
            max-height: 200px;
            overflow-y: auto;
            display: none;
            z-index: 100;
        }
        
        .search-suggestions.active {
            display: block;
        }
        
        .suggestion-item {
            padding: 10px;
            cursor: pointer;
            transition: background 0.2s;
            color: #e0e6ed;
            font-size: 14px;
        }
        
        .suggestion-item:hover {
            background: #0f1420;
        }
        
        .suggestion-item.selected {
            background: #1a2332;
        }
        
        /* ÏÑ†ÌÉùÎêú Î©§Î≤Ñ ÌëúÏãú */
        .selected-members {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin: 10px 0;
            min-height: 40px;
            padding: 10px;
            background: #050510;
            border-radius: 8px;
            border: 1px dashed #1a2332;
        }
        
        .selected-member {
            background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
            color: #1a1f3a;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 13px;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 5px;
            animation: slideIn 0.3s ease;
        }
        
        .selected-member button {
            background: none;
            border: none;
            color: #1a1f3a;
            cursor: pointer;
            font-weight: bold;
            font-size: 16px;
            line-height: 1;
            opacity: 0.7;
        }
        
        .selected-member button:hover {
            opacity: 1;
        }
        
        .tag button {
            background: none;
            border: none;
            color: inherit;
            cursor: pointer;
            font-weight: bold;
            font-size: 16px;
            line-height: 1;
            opacity: 0.7;
        }
        
        .tag button:hover {
            opacity: 1;
        }
        
        .generate-btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .generate-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(34, 197, 94, 0.4);
        }
        
        /* Ïä§ÏºÄÏ§Ñ ÌëúÏãú ÏòÅÏó≠ */
        .schedule-display {
            background: #0f1420;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
        }
        
        .schedule-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid #1a2332;
        }
        
        .schedule-title {
            font-size: 24px;
            color: #1e6deb;
            font-weight: bold;
        }
        
        .schedule-date {
            color: #9ca3af;
            font-size: 16px;
        }
        
        .stats-row {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .stat-card {
            flex: 1;
            background: #0a0a1a;
            padding: 15px;
            border-radius: 10px;
            border: 1px solid #1a2332;
            text-align: center;
        }
        
        .stat-value {
            font-size: 28px;
            font-weight: bold;
            color: #1e6deb;
            margin-bottom: 5px;
        }
        
        .stat-label {
            color: #9ca3af;
            font-size: 13px;
        }
        
        /* ÏãúÍ∞ÑÌëú */
        .time-slot {
            background: #0a0a1a;
            border: 1px solid #1a2332;
            border-radius: 10px;
            margin-bottom: 8px;
            transition: all 0.3s;
        }
        
        .time-slot:hover {
            background: #0f0f25;
            border-color: #1e6deb;
        }
        
        .time-slot.my-time {
            background: linear-gradient(135deg, rgba(30, 109, 235, 0.2) 0%, rgba(0, 82, 204, 0.2) 100%);
            border-color: #1e6deb;
            box-shadow: 0 0 20px rgba(30, 109, 235, 0.3);
        }
        
        .time-slot-content {
            display: flex;
            padding: 15px;
            align-items: center;
        }
        
        .time-label {
            width: 100px;
            font-weight: bold;
            color: #1e6deb;
            font-size: 18px;
        }
        
        .person-list {
            flex: 1;
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }
        
        .person-badge {
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 13px;
            font-weight: 500;
        }
        
        /* ÌåÄÎ≥Ñ ÏÉâÏÉÅ (ÏóëÏÖÄ Í∏∞Ï§Ä - Îã§ÌÅ¨Î™®Îìú ÏµúÏ†ÅÌôî) */
        .team-part1 { 
            background: rgba(226, 240, 217, 0.15); 
            color: #a7f3d0; 
            border: 1px solid rgba(226, 240, 217, 0.3); 
        }
        .team-part2 { 
            background: rgba(221, 235, 247, 0.15); 
            color: #93c5fd; 
            border: 1px solid rgba(221, 235, 247, 0.3); 
        }
        .team-part3 { 
            background: rgba(255, 242, 204, 0.15); 
            color: #fde047; 
            border: 1px solid rgba(255, 242, 204, 0.3); 
        }
        .team-part4 { 
            background: rgba(251, 229, 215, 0.15); 
            color: #fca5a5; 
            border: 1px solid rgba(251, 229, 215, 0.3); 
        }
        .team-part5 { 
            background: rgba(59, 130, 246, 0.2); 
            color: #3b82f6; 
            border: 1px solid rgba(59, 130, 246, 0.4); 
        }
        
        .leader-badge {
            background: linear-gradient(135deg, #ffd700 0%, #ffb300 100%) !important;
            color: #1a1f3a !important;
            font-weight: bold;
            border: none !important;
            position: relative;
        }
        
        .leader-badge::before {
            content: "‚òÖ ";
            color: #1a1f3a;
        }
        
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #6b7280;
        }
        
        .empty-icon {
            font-size: 80px;
            margin-bottom: 20px;
            opacity: 0.3;
        }
        
        .message {
            padding: 12px 20px;
            border-radius: 8px;
            margin-top: 15px;
            display: none;
            animation: slideIn 0.3s ease;
        }
        
        @keyframes slideIn {
            from {
                transform: translateY(-10px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }
        
        .success-message {
            background: rgba(34, 197, 94, 0.2);
            color: #22c55e;
            border: 1px solid rgba(34, 197, 94, 0.3);
        }
        
        .warning-message {
            background: rgba(251, 146, 60, 0.2);
            color: #fb923c;
            border: 1px solid rgba(251, 146, 60, 0.3);
        }
        
        .error-message {
            background: rgba(239, 68, 68, 0.2);
            color: #ef4444;
            border: 1px solid rgba(239, 68, 68, 0.3);
        }
    </style>
</head>
<body>
    <!-- Ìó§Îçî -->
    <div class="header">
        <div class="header-content">
            <div class="logo">
                <div class="logo-text">üçΩÔ∏è SNSÏÑºÌÑ∞ Ï†êÏã¨ Î∞∞Î∂Ñ ÌîÑÎ°úÍ∑∏Îû®</div>
            </div>
            <div class="mode-switch">
                <button class="mode-btn active" onclick="setMode('employee')">ÏÉÅÎã¥ÏÇ¨ Î™®Îìú</button>
                <button class="mode-btn" onclick="setMode('admin')">Í¥ÄÎ¶¨Ïûê Î™®Îìú</button>
            </div>
        </div>
    </div>
    
    <!-- ÎπÑÎ∞ÄÎ≤àÌò∏ Î™®Îã¨ -->
    <div id="passwordModal" class="modal">
        <div class="modal-content">
            <div class="modal-title">üîê Í¥ÄÎ¶¨Ïûê Ïù∏Ï¶ù</div>
            <input type="password" class="password-input" id="passwordInput" placeholder="ÎπÑÎ∞ÄÎ≤àÌò∏Î•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî">
            <div class="modal-buttons">
                <button class="modal-btn confirm" onclick="checkPassword()">ÌôïÏù∏</button>
                <button class="modal-btn cancel" onclick="closePasswordModal()">Ï∑®ÏÜå</button>
            </div>
            <div class="message error-message" id="passwordError"></div>
        </div>
    </div>
    
    <div class="container">
        <!-- ÏÇ¨Ïö©Ïûê Ï†ïÎ≥¥ Î∞î -->
        <div class="user-info-bar">
            <div class="my-lunch-time">
                <span class="my-lunch-label">ÎÇòÏùò Ïò§Îäò Ï†êÏã¨ ÏãúÍ∞Ñ:</span>
                <span class="my-lunch-value" id="myLunchTime">ÏÑ§Ï†ï ÌïÑÏöî</span>
            </div>
            <div class="name-setting">
                <input type="text" class="name-input" id="userName" placeholder="Ïù¥Î¶Ñ ÏûÖÎ†•">
                <button class="save-name-btn" onclick="saveName()">Ï†ÄÏû•</button>
            </div>
        </div>
        
        <!-- Í¥ÄÎ¶¨Ïûê Ìå®ÎÑê -->
        <div id="adminPanel" class="admin-panel">
            <div class="control-grid">
                <!-- ÎÇ†Ïßú ÏÑ§Ï†ï -->
                <div class="control-section">
                    <h3>üìÖ ÎÇ†Ïßú ÏÑ§Ï†ï</h3>
                    <div class="form-group">
                        <input type="date" class="form-control" id="scheduleDate">
                    </div>
                </div>
                
                <!-- Ïó∞Ï∞®Ïûê Í¥ÄÎ¶¨ -->
                <div class="control-section">
                    <h3>üèñÔ∏è Ïó∞Ï∞®Ïûê Í¥ÄÎ¶¨</h3>
                    <div class="form-group">
                        <select class="form-control" id="vacationSelect">
                            <option value="">ÏßÅÏõê ÏÑ†ÌÉù...</option>
                        </select>
                        <button class="add-btn" onclick="addVacation()">Ïó∞Ï∞®Ïûê Ï∂îÍ∞Ä</button>
                    </div>
                    <div class="tag-list" id="vacationList"></div>
                </div>
                
                <!-- ÏßùÏßÄ ÏÑ§Ï†ï -->
                <div class="control-section">
                    <h3>üë• ÏßùÏßÄ ÏÑ§Ï†ï</h3>
                    <div class="form-group">
                        <label class="form-label">ÌåÄ ÏÑ†ÌÉù</label>
                        <select class="form-control" id="pairTeamSelect" onchange="updatePairMembers()">
                            <option value="">ÌåÄ ÏÑ†ÌÉù...</option>
                            <option value="1ÌååÌä∏">1ÌååÌä∏</option>
                            <option value="2ÌååÌä∏">2ÌååÌä∏</option>
                            <option value="3ÌååÌä∏">3ÌååÌä∏</option>
                            <option value="4ÌååÌä∏">4ÌååÌä∏</option>
                            <option value="5ÌååÌä∏">5ÌååÌä∏ (ÏùòÏ†ïÎ∂Ä)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Ï≤´ Î≤àÏß∏ ÏßÅÏõê</label>
                        <select class="form-control" id="pairMember1">
                            <option value="">ÏÑ†ÌÉù...</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Îëê Î≤àÏß∏ ÏßÅÏõê</label>
                        <select class="form-control" id="pairMember2">
                            <option value="">ÏÑ†ÌÉù...</option>
                        </select>
                    </div>
                    <button class="add-btn" onclick="addPair()">ÏßùÏßÄ Ï∂îÍ∞Ä</button>
                    <div class="tag-list" id="pairList"></div>
                </div>
                
                <!-- ÌäπÎ≥Ñ Í¥ÄÎ¶¨ ÎåÄÏÉÅ -->
                <div class="control-section">
                    <h3>‚ö° ÌäπÎ≥Ñ Í¥ÄÎ¶¨ ÎåÄÏÉÅ</h3>
                    <p style="color: #9ca3af; font-size: 12px; margin-bottom: 10px;">
                        ÏÉÅÎã¥ ÌååÏõåÍ∞Ä Í∞ïÌï¥ ÎèôÏãúÏóê Ï†êÏã¨ÏùÑ Í∞ÄÎ©¥ Ïïà ÎêòÎäî ÏßÅÏõêÎì§
                    </p>
                    <div class="form-group">
                        <div style="position: relative;">
                            <input type="text" 
                                   class="form-control" 
                                   id="specialSearchInput" 
                                   placeholder="Ïù¥Î¶Ñ ÏûÖÎ†• ÌõÑ Enter (ÏµúÏÜå 2Î™Ö)"
                                   onkeyup="handleSpecialSearch(event)"
                                   autocomplete="off">
                            <div id="searchSuggestions" class="search-suggestions"></div>
                        </div>
                        <div class="selected-members" id="selectedMembers"></div>
                        <button class="add-btn" onclick="createSpecialGroup()" id="createGroupBtn" style="display: none;">
                            Í∑∏Î£π ÏÉùÏÑ± (0Î™Ö ÏÑ†ÌÉùÎê®)
                        </button>
                    </div>
                    <div class="tag-list" id="specialList"></div>
                </div>
            </div>
            
            <button class="generate-btn" onclick="generateSchedule()">
                üöÄ Ï†êÏã¨ ÏãúÍ∞ÑÌëú ÏÉùÏÑ±
            </button>
            
            <div class="message success-message" id="successMessage"></div>
            <div class="message warning-message" id="warningMessage"></div>
        </div>
        
        <!-- Ïä§ÏºÄÏ§Ñ ÌëúÏãú ÏòÅÏó≠ -->
        <div class="schedule-display">
            <div id="emptyState" class="empty-state">
                <div class="empty-icon">üìã</div>
                <h2>Ï†êÏã¨ ÏãúÍ∞ÑÌëúÍ∞Ä ÏïÑÏßÅ ÏÉùÏÑ±ÎêòÏßÄ ÏïäÏïòÏäµÎãàÎã§</h2>
                <p style="margin-top: 10px; color: #6b7280;">Í¥ÄÎ¶¨ÏûêÍ∞Ä ÏãúÍ∞ÑÌëúÎ•º ÏÉùÏÑ±ÌïòÎ©¥ Ïó¨Í∏∞Ïóê ÌëúÏãúÎê©ÎãàÎã§</p>
            </div>
            
            <div id="scheduleContent" style="display: none;">
                <div class="schedule-header">
                    <div class="schedule-title">Ï†êÏã¨ ÏãúÍ∞ÑÌëú</div>
                    <div class="schedule-date" id="scheduleDateDisplay"></div>
                </div>
                
                <div class="stats-row">
                    <div class="stat-card">
                        <div class="stat-value" id="totalCount">0</div>
                        <div class="stat-label">Ï¥ù Ïù∏Ïõê</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="morningCount">0</div>
                        <div class="stat-label">Ïò§Ï†Ñ Í∑ºÎ¨¥</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="afternoonCount">0</div>
                        <div class="stat-label">Ïò§ÌõÑ Í∑ºÎ¨¥</div>
                    </div>
                </div>
                
                <div id="scheduleTableContainer"></div>
            </div>
        </div>
    </div>
    
    <script>
        // ÏßÅÏõê Îç∞Ïù¥ÌÑ∞ (ÎπÖÎç∞Ïù¥ÌÑ∞ Î∂ÑÏÑù Í∏∞Î∞ò ÏóÖÎç∞Ïù¥Ìä∏)
        const employeeData = [
            // 1ÌååÌä∏
            { name: "Ïù¥Ï¢ÖÎØº", team: "1ÌååÌä∏", position: "ÌååÌä∏Ïû•", shift: "Ïò§Ï†Ñ", startTime: "08:00" },
            { name: "Ï†ïÏ£ºÏó∞", team: "1ÌååÌä∏", position: "ÌååÌä∏Ïõê", shift: "Ïò§Ï†Ñ", startTime: "09:00" },
            { name: "Ïù¥ÌòúÏòÅ", team: "1ÌååÌä∏", position: "ÌååÌä∏Ïõê", shift: "Ïò§ÌõÑ", startTime: "13:00" },
            { name: "ÍπÄÍµ≠ÌòÑ", team: "1ÌååÌä∏", position: "ÌååÌä∏Ïõê", shift: "Ïò§ÌõÑ", startTime: "13:00" },
            { name: "Ï†ïÎã§Ìòú", team: "1ÌååÌä∏", position: "ÌååÌä∏Ïõê", shift: "Ïò§Ï†Ñ", startTime: "09:00" },
            { name: "Ï°∞ÏãúÌòÑ", team: "1ÌååÌä∏", position: "ÌååÌä∏Ïõê", shift: "Ïò§Ï†Ñ", startTime: "09:30" },
            { name: "ÍπÄÏãúÏú§", team: "1ÌååÌä∏", position: "ÌååÌä∏Ïõê", shift: "Ïò§ÌõÑ", startTime: "13:00" },
            // 2ÌååÌä∏
            { name: "Ïú§ÎèÑÏö∞Î¶¨", team: "2ÌååÌä∏", position: "ÌååÌä∏Ïû•", shift: "Ïò§Ï†Ñ", startTime: "09:00" },
            { name: "Ïã†ÌòúÏÑú", team: "2ÌååÌä∏", position: "ÌååÌä∏Ïõê", shift: "Ïò§Ï†Ñ", startTime: "09:00" },
            { name: "ÍπÄÏÉÅÏïÑ", team: "2ÌååÌä∏", position: "ÌååÌä∏Ïõê", shift: "Ïò§Ï†Ñ", startTime: "09:30" },
            { name: "Î∞ïÏùÄÏßÑ", team: "2ÌååÌä∏", position: "ÌååÌä∏Ïõê", shift: "Ïò§ÌõÑ", startTime: "13:00" },
            { name: "Ïò§ÎØºÌôò", team: "2ÌååÌä∏", position: "ÌååÌä∏Ïõê", shift: "Ïò§ÌõÑ", startTime: "13:00" },
            { name: "ÏÑúÏ†ïÍµ≠", team: "2ÌååÌä∏", position: "ÌååÌä∏Ïõê", shift: "Ïò§ÌõÑ", startTime: "13:00" },
            // 3ÌååÌä∏
            { name: "ÍπÄÏßÑÌõÑ", team: "3ÌååÌä∏", position: "ÌååÌä∏Ïû•", shift: "Ïò§ÌõÑ", startTime: "13:00" },
            { name: "ÍπÄÏãúÏßÑ", team: "3ÌååÌä∏", position: "ÌååÌä∏Ïõê", shift: "Ïò§Ï†Ñ", startTime: "10:00" },
            { name: "Í∂åÏû¨ÌòÑ", team: "3ÌååÌä∏", position: "ÌååÌä∏Ïõê", shift: "Ïò§Ï†Ñ", startTime: "10:00" },
            { name: "ÍπÄÏßÄÏõê", team: "3ÌååÌä∏", position: "ÌååÌä∏Ïõê", shift: "Ïò§Ï†Ñ", startTime: "10:00" },
            { name: "ÏµúÌò∏Ïùµ", team: "3ÌååÌä∏", position: "ÌååÌä∏Ïõê", shift: "Ïò§ÌõÑ", startTime: "13:00" },
            { name: "ÍπÄÏßÑÌòë", team: "3ÌååÌä∏", position: "ÌååÌä∏Ïõê", shift: "Ïò§ÌõÑ", startTime: "13:00" },
            { name: "Î∞ïÌï¥ÏòÅ", team: "3ÌååÌä∏", position: "ÌååÌä∏Ïõê", shift: "Ïò§Ï†Ñ", startTime: "08:00" },
            { name: "ÍπÄÏ¢ÖÌòÑ", team: "3ÌååÌä∏", position: "ÌååÌä∏Ïõê", shift: "Ïò§ÌõÑ", startTime: "13:00" },
            { name: "Í≥µÌòÑÏ§Ä", team: "3ÌååÌä∏", position: "ÌååÌä∏Ïõê", shift: "Ïò§Ï†Ñ", startTime: "09:00" },
            // 4ÌååÌä∏
            { name: "Ïù¥ÎØºÏ£º", team: "4ÌååÌä∏", position: "ÌååÌä∏Ïû•", shift: "Ïò§Ï†Ñ", startTime: "09:00" },
            { name: "Ï†ÑÏßÄÏú§", team: "4ÌååÌä∏", position: "ÌååÌä∏Ïõê", shift: "Ïò§Ï†Ñ", startTime: "08:00" },
            { name: "Ï†ÑÎØ∏ÎûÄ", team: "4ÌååÌä∏", position: "ÌååÌä∏Ïõê", shift: "Ïò§ÌõÑ", startTime: "13:00" },
            { name: "ÍπÄÏ±ÑÏòÅ", team: "4ÌååÌä∏", position: "ÌååÌä∏Ïõê", shift: "Ïò§Ï†Ñ", startTime: "09:00" },
            { name: "ÍπÄÏòÅÏßÑ", team: "4ÌååÌä∏", position: "ÌååÌä∏Ïõê", shift: "Ïò§ÌõÑ", startTime: "13:00" },
            { name: "Í∞ïÌóåÏ§Ä", team: "4ÌååÌä∏", position: "ÌååÌä∏Ïõê", shift: "Ïò§ÌõÑ", startTime: "13:00" },
            // 5ÌååÌä∏ (ÏùòÏ†ïÎ∂Ä)
            { name: "Ï∞®Ï†ïÌôò", team: "5ÌååÌä∏", position: "ÌååÌä∏Ïû•", shift: "Ïò§Ï†Ñ", startTime: "10:00" },
            { name: "ÏµúÏàòÎä•", team: "5ÌååÌä∏", position: "ÌååÌä∏Ïõê", shift: "Ïò§Ï†Ñ", startTime: "10:00" },
            { name: "Íµ¨Î≥∏ÏòÅ", team: "5ÌååÌä∏", position: "ÌååÌä∏Ïõê", shift: "Ïò§Ï†Ñ", startTime: "10:00" },
            { name: "ÏÑúÎØºÍµ≠", team: "5ÌååÌä∏", position: "ÌååÌä∏Ïõê", shift: "Ïò§Ï†Ñ", startTime: "10:00" },
            { name: "Ïò§ÎØºÍ≤Ω", team: "5ÌååÌä∏", position: "ÌååÌä∏Ïõê", shift: "Ïò§Ï†Ñ", startTime: "10:00" },
            { name: "ÍπÄÎ≤îÏ£º", team: "5ÌååÌä∏", position: "ÌååÌä∏Ïõê", shift: "Ïò§Ï†Ñ", startTime: "10:00" },
            { name: "ÎèôÏàòÏßÑ", team: "5ÌååÌä∏", position: "ÌååÌä∏Ïõê", shift: "Ïò§Ï†Ñ", startTime: "09:30" },
            { name: "ÏÑ±ÏùºÌõà", team: "5ÌååÌä∏", position: "ÌååÌä∏Ïõê", shift: "Ïò§Ï†Ñ", startTime: "10:00" }
        ];
        
        // Ï†ÑÏó≠ Î≥ÄÏàò
        const leaders = ["Ïù¥Ï¢ÖÎØº", "Ïú§ÎèÑÏö∞Î¶¨", "ÍπÄÏßÑÌõÑ", "Ïù¥ÎØºÏ£º", "Ï∞®Ï†ïÌôò"];
        const lunchSlots = [
            "11:30", "12:00", "12:30", "13:00", "13:30",
            "14:00", "14:30", "15:00", "15:30", "16:00",
            "16:30", "17:00", "17:30", "18:00", "18:30",
            "19:00", "19:30"
        ];
        const leaderSlots = ["12:00", "13:00", "14:00", "15:00", "16:00", "17:00", "18:00", "19:00"];
        const memberSlots = ["11:30", "12:30", "13:30", "14:30", "15:30", "16:30", "17:30", "18:30", "19:30"];
        
        let currentMode = 'employee';
        let vacationList = [];
        let pairList = [];
        let specialGroups = [];
        let selectedSpecialMembers = [];
        let currentSchedule = null;
        
        // Ï¥àÍ∏∞Ìôî
        window.onload = function() {
            // Ïò§Îäò ÎÇ†Ïßú ÏÑ§Ï†ï
            const today = new Date();
            document.getElementById('scheduleDate').value = today.toISOString().split('T')[0];
            
            // ÏßÅÏõê Î™©Î°ù Ï±ÑÏö∞Í∏∞
            const vacationSelect = document.getElementById('vacationSelect');
            employeeData.forEach(emp => {
                const option = document.createElement('option');
                option.value = emp.name;
                option.textContent = `${emp.name} (${emp.team})`;
                vacationSelect.appendChild(option);
            });
            
            // ÌäπÎ≥Ñ Í¥ÄÎ¶¨ ÎåÄÏÉÅ Ï¥àÍ∏∞Ìôî
            updateSelectedMembersDisplay();
            
            // Ï†ÄÏû•Îêú Ïù¥Î¶Ñ Î∂àÎü¨Ïò§Í∏∞
            loadUserName();
            
            // Ï†ÄÏû•Îêú Ïä§ÏºÄÏ§Ñ Î∂àÎü¨Ïò§Í∏∞
            loadScheduleFromStorage();
        };
        
        // Î™®Îìú Ï†ÑÌôò
        function setMode(mode) {
            if (mode === 'admin') {
                document.getElementById('passwordModal').classList.add('active');
            } else {
                currentMode = 'employee';
                document.getElementById('adminPanel').classList.remove('active');
                document.querySelectorAll('.mode-btn').forEach(btn => {
                    btn.classList.remove('active');
                });
                document.querySelector('.mode-btn').classList.add('active');
            }
        }
        
        // ÎπÑÎ∞ÄÎ≤àÌò∏ ÌôïÏù∏
        function checkPassword() {
            const password = document.getElementById('passwordInput').value;
            if (password === '3504') {
                currentMode = 'admin';
                document.getElementById('adminPanel').classList.add('active');
                document.querySelectorAll('.mode-btn').forEach(btn => {
                    btn.classList.remove('active');
                });
                document.querySelectorAll('.mode-btn')[1].classList.add('active');
                closePasswordModal();
            } else {
                const errorMsg = document.getElementById('passwordError');
                errorMsg.textContent = 'ÎπÑÎ∞ÄÎ≤àÌò∏Í∞Ä Ïò¨Î∞îÎ•¥ÏßÄ ÏïäÏäµÎãàÎã§.';
                errorMsg.style.display = 'block';
                setTimeout(() => {
                    errorMsg.style.display = 'none';
                }, 3000);
            }
        }
        
        // ÎπÑÎ∞ÄÎ≤àÌò∏ Î™®Îã¨ Îã´Í∏∞
        function closePasswordModal() {
            document.getElementById('passwordModal').classList.remove('active');
            document.getElementById('passwordInput').value = '';
        }
        
        // Ïù¥Î¶Ñ Ï†ÄÏû•
        function saveName() {
            const name = document.getElementById('userName').value.trim();
            if (name) {
                localStorage.setItem('userName', name);
                updateMyLunchTime();
                showSuccess(`${name}ÎãòÏúºÎ°ú ÏÑ§Ï†ïÎêòÏóàÏäµÎãàÎã§.`);
            }
        }
        
        // Ï†ÄÏû•Îêú Ïù¥Î¶Ñ Î∂àÎü¨Ïò§Í∏∞
        function loadUserName() {
            const savedName = localStorage.getItem('userName');
            if (savedName) {
                document.getElementById('userName').value = savedName;
                updateMyLunchTime();
            }
        }
        
        // ÎÇòÏùò Ï†êÏã¨ ÏãúÍ∞Ñ ÏóÖÎç∞Ïù¥Ìä∏
        function updateMyLunchTime() {
            const userName = localStorage.getItem('userName');
            const myLunchElement = document.getElementById('myLunchTime');
            
            if (!userName || !currentSchedule) {
                myLunchElement.textContent = 'ÏÑ§Ï†ï ÌïÑÏöî';
                return;
            }
            
            let myTime = null;
            for (const [time, people] of Object.entries(currentSchedule)) {
                if (people.some(p => p.name === userName)) {
                    myTime = time;
                    break;
                }
            }
            
            myLunchElement.textContent = myTime || 'ÎØ∏Î∞∞Ï†ï';
            highlightMyTime();
        }
        
        // ÎÇ¥ ÏãúÍ∞Ñ ÌïòÏù¥ÎùºÏù¥Ìä∏
        function highlightMyTime() {
            const userName = localStorage.getItem('userName');
            if (!userName || !currentSchedule) return;
            
            document.querySelectorAll('.time-slot').forEach(slot => {
                slot.classList.remove('my-time');
            });
            
            document.querySelectorAll('.time-slot').forEach(slot => {
                const badges = slot.querySelectorAll('.person-badge');
                badges.forEach(badge => {
                    if (badge.textContent.includes(userName)) {
                        slot.classList.add('my-time');
                    }
                });
            });
        }
        
        // Ïó∞Ï∞®Ïûê Ï∂îÍ∞Ä
        function addVacation() {
            const select = document.getElementById('vacationSelect');
            const name = select.value;
            
            if (name && !vacationList.includes(name)) {
                vacationList.push(name);
                updateVacationDisplay();
                select.value = '';
                showSuccess(`${name}ÎãòÏù¥ Ïó∞Ï∞®ÏûêÎ°ú Ï∂îÍ∞ÄÎêòÏóàÏäµÎãàÎã§.`);
            }
        }
        
        // Ïó∞Ï∞®Ïûê Ï†úÍ±∞
        function removeVacation(name) {
            vacationList = vacationList.filter(v => v !== name);
            updateVacationDisplay();
        }
        
        // Ïó∞Ï∞®Ïûê Î™©Î°ù ÌëúÏãú
        function updateVacationDisplay() {
            const container = document.getElementById('vacationList');
            container.innerHTML = '';
            
            vacationList.forEach(name => {
                const tag = document.createElement('div');
                tag.className = 'tag vacation-tag';
                tag.innerHTML = `
                    ${name}
                    <button onclick="removeVacation('${name}')">√ó</button>
                `;
                container.appendChild(tag);
            });
        }
        
        // ÌåÄÏõê Î™©Î°ù ÏóÖÎç∞Ïù¥Ìä∏
        function updatePairMembers() {
            const team = document.getElementById('pairTeamSelect').value;
            const member1Select = document.getElementById('pairMember1');
            const member2Select = document.getElementById('pairMember2');
            
            member1Select.innerHTML = '<option value="">ÏÑ†ÌÉù...</option>';
            member2Select.innerHTML = '<option value="">ÏÑ†ÌÉù...</option>';
            
            if (team) {
                const teamMembers = employeeData.filter(emp => emp.team === team);
                teamMembers.forEach(emp => {
                    member1Select.innerHTML += `<option value="${emp.name}">${emp.name}</option>`;
                    member2Select.innerHTML += `<option value="${emp.name}">${emp.name}</option>`;
                });
            }
        }
        
        // ÏßùÏßÄ Ï∂îÍ∞Ä
        function addPair() {
            const member1 = document.getElementById('pairMember1').value;
            const member2 = document.getElementById('pairMember2').value;
            
            if (member1 && member2 && member1 !== member2) {
                const pairKey = [member1, member2].sort().join('-');
                const exists = pairList.some(pair => {
                    const key = [pair.member1, pair.member2].sort().join('-');
                    return key === pairKey;
                });
                
                if (!exists) {
                    pairList.push({ member1, member2 });
                    updatePairDisplay();
                    document.getElementById('pairMember1').value = '';
                    document.getElementById('pairMember2').value = '';
                    showSuccess(`${member1}ÎãòÍ≥º ${member2}ÎãòÏù¥ ÏßùÏßÄÎ°ú ÏÑ§Ï†ïÎêòÏóàÏäµÎãàÎã§.`);
                } else {
                    showWarning('Ïù¥ÎØ∏ ÏÑ§Ï†ïÎêú ÏßùÏßÄÏûÖÎãàÎã§.');
                }
            } else if (member1 === member2) {
                showWarning('Í∞ôÏùÄ ÏÇ¨ÎûåÏùÑ ÏßùÏßÄÎ°ú ÏÑ§Ï†ïÌï† Ïàò ÏóÜÏäµÎãàÎã§.');
            }
        }
        
        // ÏßùÏßÄ Ï†úÍ±∞
        function removePair(index) {
            pairList.splice(index, 1);
            updatePairDisplay();
        }
        
        // ÏßùÏßÄ Î™©Î°ù ÌëúÏãú
        function updatePairDisplay() {
            const container = document.getElementById('pairList');
            container.innerHTML = '';
            
            pairList.forEach((pair, index) => {
                const tag = document.createElement('div');
                tag.className = 'tag pair-tag';
                tag.innerHTML = `
                    ${pair.member1} ‚Üî ${pair.member2}
                    <button onclick="removePair(${index})">√ó</button>
                `;
                container.appendChild(tag);
            });
        }
        
        // ÌäπÎ≥Ñ Í¥ÄÎ¶¨ ÎåÄÏÉÅ Í≤ÄÏÉâ Ï≤òÎ¶¨
        function handleSpecialSearch(event) {
            const input = document.getElementById('specialSearchInput');
            const searchValue = input.value.trim().toLowerCase();
            const suggestionsDiv = document.getElementById('searchSuggestions');
            
            if (event.key === 'Enter' && searchValue) {
                const firstMatch = employeeData.find(emp => 
                    emp.name.toLowerCase().includes(searchValue) &&
                    !selectedSpecialMembers.includes(emp.name)
                );
                
                if (firstMatch) {
                    addSpecialMember(firstMatch.name);
                    input.value = '';
                    suggestionsDiv.classList.remove('active');
                }
                return;
            }
            
            if (searchValue) {
                const matches = employeeData.filter(emp => 
                    emp.name.toLowerCase().includes(searchValue) &&
                    !selectedSpecialMembers.includes(emp.name)
                );
                
                if (matches.length > 0) {
                    suggestionsDiv.innerHTML = matches.map(emp => 
                        `<div class="suggestion-item" onclick="addSpecialMember('${emp.name}')">
                            ${emp.name} (${emp.team})
                        </div>`
                    ).join('');
                    suggestionsDiv.classList.add('active');
                } else {
                    suggestionsDiv.classList.remove('active');
                }
            } else {
                suggestionsDiv.classList.remove('active');
            }
        }
        
        // ÌäπÎ≥Ñ Í¥ÄÎ¶¨ ÎåÄÏÉÅ Î©§Î≤Ñ Ï∂îÍ∞Ä
        function addSpecialMember(name) {
            if (!selectedSpecialMembers.includes(name)) {
                selectedSpecialMembers.push(name);
                updateSelectedMembersDisplay();
                document.getElementById('specialSearchInput').value = '';
                document.getElementById('searchSuggestions').classList.remove('active');
            }
        }
        
        // ÌäπÎ≥Ñ Í¥ÄÎ¶¨ ÎåÄÏÉÅ Î©§Î≤Ñ Ï†úÍ±∞
        function removeSpecialMember(name) {
            selectedSpecialMembers = selectedSpecialMembers.filter(m => m !== name);
            updateSelectedMembersDisplay();
        }
        
        // ÏÑ†ÌÉùÎêú Î©§Î≤Ñ ÌëúÏãú ÏóÖÎç∞Ïù¥Ìä∏
        function updateSelectedMembersDisplay() {
            const container = document.getElementById('selectedMembers');
            const createBtn = document.getElementById('createGroupBtn');
            
            if (selectedSpecialMembers.length > 0) {
                container.innerHTML = selectedSpecialMembers.map(name => 
                    `<div class="selected-member">
                        ${name}
                        <button onclick="removeSpecialMember('${name}')">√ó</button>
                    </div>`
                ).join('');
                
                if (selectedSpecialMembers.length >= 2) {
                    createBtn.style.display = 'block';
                    createBtn.textContent = `Í∑∏Î£π ÏÉùÏÑ± (${selectedSpecialMembers.length}Î™Ö ÏÑ†ÌÉùÎê®)`;
                } else {
                    createBtn.style.display = 'block';
                    createBtn.textContent = `ÏµúÏÜå 2Î™Ö Ïù¥ÏÉÅ ÏÑ†ÌÉùÌïòÏÑ∏Ïöî (ÌòÑÏû¨ ${selectedSpecialMembers.length}Î™Ö)`;
                    createBtn.disabled = true;
                }
            } else {
                container.innerHTML = '<span style="color: #6b7280; font-size: 13px;">ÏÑ†ÌÉùÎêú ÏßÅÏõêÏù¥ ÏóÜÏäµÎãàÎã§</span>';
                createBtn.style.display = 'none';
            }
            
            createBtn.disabled = selectedSpecialMembers.length < 2;
        }
        
        // ÌäπÎ≥Ñ Í¥ÄÎ¶¨ Í∑∏Î£π ÏÉùÏÑ±
        function createSpecialGroup() {
            if (selectedSpecialMembers.length < 2) {
                showWarning('ÌäπÎ≥Ñ Í¥ÄÎ¶¨ ÎåÄÏÉÅÏùÄ ÏµúÏÜå 2Î™Ö Ïù¥ÏÉÅ ÏÑ†ÌÉùÌï¥Ï£ºÏÑ∏Ïöî.');
                return;
            }
            
            const isDuplicate = specialGroups.some(group => {
                const sortedNew = [...selectedSpecialMembers].sort().join(',');
                const sortedExisting = [...group].sort().join(',');
                return sortedNew === sortedExisting;
            });
            
            if (!isDuplicate) {
                specialGroups.push([...selectedSpecialMembers]);
                updateSpecialDisplay();
                selectedSpecialMembers = [];
                updateSelectedMembersDisplay();
                showSuccess(`ÌäπÎ≥Ñ Í¥ÄÎ¶¨ Í∑∏Î£πÏù¥ ÏÉùÏÑ±ÎêòÏóàÏäµÎãàÎã§!`);
            } else {
                showWarning('Ïù¥ÎØ∏ Îì±Î°ùÎêú Í∑∏Î£πÏûÖÎãàÎã§.');
            }
        }
        
        // ÌäπÎ≥Ñ Í¥ÄÎ¶¨ ÎåÄÏÉÅ Í∑∏Î£π Ï†úÍ±∞
        function removeSpecialGroup(index) {
            specialGroups.splice(index, 1);
            updateSpecialDisplay();
        }
        
        // ÌäπÎ≥Ñ Í¥ÄÎ¶¨ ÎåÄÏÉÅ Î™©Î°ù ÌëúÏãú
        function updateSpecialDisplay() {
            const container = document.getElementById('specialList');
            container.innerHTML = '';
            
            specialGroups.forEach((group, index) => {
                const tag = document.createElement('div');
                tag.className = 'tag special-tag';
                const displayText = group.length > 3 
                    ? `${group.slice(0, 3).join(', ')}... (${group.length}Î™Ö)`
                    : group.join(', ');
                tag.innerHTML = `
                    ‚ö° ${displayText}
                    <button onclick="removeSpecialGroup(${index})">√ó</button>
                `;
                tag.title = group.join(', ');
                container.appendChild(tag);
            });
        }
        
        // Ï†êÏã¨ ÏãúÍ∞ÑÌëú ÏÉùÏÑ± (ÎπÖÎç∞Ïù¥ÌÑ∞ Í∏∞Î∞ò ÏµúÏ†ÅÌôî)
        function generateSchedule() {
            const availableEmployees = employeeData.filter(emp => !vacationList.includes(emp.name));
            
            if (availableEmployees.length === 0) {
                showWarning('Î∞∞Ï†ï Í∞ÄÎä•Ìïú ÏßÅÏõêÏù¥ ÏóÜÏäµÎãàÎã§.');
                return;
            }
            
            const schedule = {};
            lunchSlots.forEach(slot => {
                schedule[slot] = [];
            });
            
            // Ïò§Ï†Ñ/Ïò§ÌõÑ Í∑ºÎ¨¥Ïûê Î∂ÑÎ¶¨
            const morningWorkers = availableEmployees.filter(emp => emp.shift === 'Ïò§Ï†Ñ');
            const afternoonWorkers = availableEmployees.filter(emp => emp.shift === 'Ïò§ÌõÑ');
            
            // ÌååÌä∏Ïû•Í≥º ÌååÌä∏Ïõê Î∂ÑÎ¶¨
            const morningLeaders = morningWorkers.filter(emp => leaders.includes(emp.name));
            const morningMembers = morningWorkers.filter(emp => !leaders.includes(emp.name));
            const afternoonLeaders = afternoonWorkers.filter(emp => leaders.includes(emp.name));
            const afternoonMembers = afternoonWorkers.filter(emp => !leaders.includes(emp.name));
            
            // ÎπÖÎç∞Ïù¥ÌÑ∞ Í∏∞Î∞ò ÏÑ†Ìò∏ ÏãúÍ∞ÑÎåÄ Ìå®ÌÑ¥
            const preferredTimes = {
                "11:30": ["Ï†ïÎã§Ìòú", "ÏÑ±ÏùºÌõà", "ÍπÄÎ≤îÏ£º", "Ï°∞ÏãúÌòÑ"],
                "12:30": ["ÍπÄÏ±ÑÏòÅ", "Î∞ïÌï¥ÏòÅ", "Ïò§ÎØºÍ≤Ω", "Í∂åÏû¨ÌòÑ", "Í≥µÌòÑÏ§Ä"],
                "13:30": ["Íµ¨Î≥∏ÏòÅ", "Ï†ïÏ£ºÏó∞", "Ï†ÑÏßÄÏú§", "Ïã†ÌòúÏÑú", "ÍπÄÏÉÅÏïÑ"],
                "14:30": ["ÍπÄÏãúÏßÑ", "ÏÑúÎØºÍµ≠", "ÏµúÏàòÎä•"],
                "15:30": ["ÍπÄÏßÄÏõê", "ÎèôÏàòÏßÑ", "ÍπÄÍµ≠ÌòÑ", "Ïù¥ÌòúÏòÅ"],
                "16:30": ["Ï†ÑÎØ∏ÎûÄ", "ÍπÄÏãúÏú§", "ÏµúÌò∏Ïùµ", "ÍπÄÏ¢ÖÌòÑ"],
                "17:30": ["ÏÑúÏ†ïÍµ≠", "ÍπÄÏòÅÏßÑ", "Í∞ïÌóåÏ§Ä"],
                "18:30": ["ÍπÄÏßÑÌòë", "Ïò§ÎØºÌôò", "Î∞ïÏùÄÏßÑ"]
            };
            
            // ÏûêÏ£º Ìï®Íªò Ï†êÏã¨ÏùÑ Î®πÎäî Í∑∏Î£π
            const frequentGroups = [
                ["Ï†ïÎã§Ìòú", "ÏÑ±ÏùºÌõà", "ÍπÄÎ≤îÏ£º"],
                ["ÏÑúÎØºÍµ≠", "ÏµúÏàòÎä•"],
                ["ÍπÄÏßÄÏõê", "ÎèôÏàòÏßÑ"],
                ["ÍπÄÏòÅÏßÑ", "ÍπÄÏßÑÌòë"],
                ["ÍπÄÍµ≠ÌòÑ", "ÍπÄÏãúÏú§"],
                ["Ïò§ÎØºÍ≤Ω", "Íµ¨Î≥∏ÏòÅ", "Í≥µÌòÑÏ§Ä"]
            ];
            
            // 1. ÌååÌä∏Ïû• Î∞∞Ï†ï (ÎπÖÎç∞Ïù¥ÌÑ∞ Í∏∞Î∞ò)
            const leaderPreferences = {
                "Ïù¥Ï¢ÖÎØº": ["12:00", "13:00"],
                "Ï∞®Ï†ïÌôò": ["12:00", "13:00", "15:00", "16:00"],
                "Ïù¥ÎØºÏ£º": ["14:00", "16:00"],
                "Ïú§ÎèÑÏö∞Î¶¨": ["15:00", "16:00", "17:30"],
                "ÍπÄÏßÑÌõÑ": ["17:00", "18:30"]
            };
            
            [...morningLeaders, ...afternoonLeaders].forEach(leader => {
                const preferences = leaderPreferences[leader.name] || 
                    (leader.shift === "Ïò§Ï†Ñ" ? ["13:00", "14:00", "15:00", "16:00"] : ["17:00", "18:00"]);
                
                let bestSlot = null;
                let minCount = Infinity;
                
                for (const slot of preferences) {
                    if (schedule[slot].length < minCount) {
                        minCount = schedule[slot].length;
                        bestSlot = slot;
                    }
                }
                
                if (bestSlot) {
                    schedule[bestSlot].push(leader);
                }
            });
            
            // 2. ÌååÌä∏Ïõê Î∞∞Ï†ï (ÎπÖÎç∞Ïù¥ÌÑ∞ Í∏∞Î∞ò Ìå®ÌÑ¥ Ï†ÅÏö©)
            const assignedMembers = new Set();
            
            // ÏÑ†Ìò∏ ÏãúÍ∞ÑÎåÄÍ∞Ä ÏûàÎäî ÏßÅÏõêÎì§ Ïö∞ÏÑ† Î∞∞Ï†ï
            Object.entries(preferredTimes).forEach(([time, names]) => {
                const [hour, minute] = time.split(':').map(Number);
                
                names.forEach(name => {
                    const member = [...morningMembers, ...afternoonMembers].find(m => m.name === name);
                    if (member && !assignedMembers.has(name) && !vacationList.includes(name)) {
                        const canAssign = (member.shift === "Ïò§Ï†Ñ" && (hour < 16 || (hour === 16 && minute === 0))) ||
                                        (member.shift === "Ïò§ÌõÑ" && hour >= 15);
                        
                        if (canAssign && schedule[time].length < 5) {
                            schedule[time].push(member);
                            assignedMembers.add(name);
                        }
                    }
                });
            });
            
            // ÎÇòÎ®∏ÏßÄ ÏßÅÏõêÎì§ Î∞∞Ï†ï
            const remainingMembers = [...morningMembers, ...afternoonMembers].filter(
                m => !assignedMembers.has(m.name)
            );
            
            remainingMembers.forEach(member => {
                const availableSlots = member.shift === "Ïò§Ï†Ñ" 
                    ? memberSlots.filter(slot => {
                        const [hour, minute] = slot.split(':').map(Number);
                        return hour < 16 || (hour === 16 && minute === 0);
                    })
                    : memberSlots.filter(slot => {
                        const [hour] = slot.split(':').map(Number);
                        return hour >= 15;
                    });
                
                let bestSlot = null;
                let bestScore = -Infinity;
                
                for (const slot of availableSlots) {
                    let score = 0;
                    
                    // Ïù∏ÏõêÏù¥ Ï†ÅÏùÄ ÏãúÍ∞ÑÎåÄ ÏÑ†Ìò∏
                    score -= schedule[slot].length * 10;
                    
                    // ÏûêÏ£º Ìï®Íªò Î®πÎäî Í∑∏Î£π Ï≤¥ÌÅ¨
                    const friendsInSlot = schedule[slot].filter(emp => {
                        return frequentGroups.some(group => 
                            group.includes(member.name) && group.includes(emp.name)
                        );
                    }).length;
                    score += friendsInSlot * 5;
                    
                    // Í∞ôÏùÄ ÌåÄ ÎÑàÎ¨¥ ÎßéÏúºÎ©¥ Í∞êÏ†ê
                    const sameTeamCount = schedule[slot].filter(emp => 
                        emp.team === member.team && !leaders.includes(emp.name)
                    ).length;
                    if (sameTeamCount >= 2) score -= 20;
                    
                    // ÏßùÏßÄ Ï≤¥ÌÅ¨
                    const hasPair = schedule[slot].some(emp => {
                        return pairList.some(pair => 
                            (pair.member1 === member.name && pair.member2 === emp.name) ||
                            (pair.member2 === member.name && pair.member1 === emp.name)
                        );
                    });
                    if (hasPair) score += 30;
                    
                    // ÌäπÎ≥Ñ Í¥ÄÎ¶¨ ÎåÄÏÉÅ Ï≤¥ÌÅ¨
                    const hasSpecialConflict = schedule[slot].some(emp => {
                        return specialGroups.some(group => 
                            group.includes(member.name) && group.includes(emp.name)
                        );
                    });
                    if (hasSpecialConflict) score -= 100;
                    
                    // ÏãúÍ∞ÑÎåÄÎ≥Ñ ÏµúÎåÄ Ïù∏Ïõê Ï†úÌïú
                    if (schedule[slot].length >= 5) score -= 1000;
                    
                    if (score > bestScore) {
                        bestScore = score;
                        bestSlot = slot;
                    }
                }
                
                if (bestSlot && schedule[bestSlot].length < 6) {
                    schedule[bestSlot].push(member);
                }
            });
            
            // Îπà ÏãúÍ∞ÑÎåÄ Ï†úÍ±∞
            Object.keys(schedule).forEach(slot => {
                if (schedule[slot].length === 0) {
                    delete schedule[slot];
                }
            });
            
            currentSchedule = schedule;
            saveScheduleToStorage();
            displaySchedule(schedule);
            showSuccess('Ï†êÏã¨ ÏãúÍ∞ÑÌëúÍ∞Ä ÏÑ±Í≥µÏ†ÅÏúºÎ°ú ÏÉùÏÑ±ÎêòÏóàÏäµÎãàÎã§!');
        }
        
        // Ïä§ÏºÄÏ§Ñ Ï†ÄÏû•
        function saveScheduleToStorage() {
            const scheduleData = {
                date: document.getElementById('scheduleDate').value,
                schedule: currentSchedule,
                timestamp: new Date().getTime()
            };
            localStorage.setItem('lunchSchedule', JSON.stringify(scheduleData));
        }
        
        // Ïä§ÏºÄÏ§Ñ Î∂àÎü¨Ïò§Í∏∞
        function loadScheduleFromStorage() {
            const saved = localStorage.getItem('lunchSchedule');
            if (saved) {
                const data = JSON.parse(saved);
                const today = new Date().toISOString().split('T')[0];
                if (data.date === today) {
                    currentSchedule = data.schedule;
                    displaySchedule(currentSchedule);
                }
            }
        }
        
        // Î∞∞Ïó¥ ÏÑûÍ∏∞
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }
        
        // ÌåÄÎ≥Ñ ÌÅ¥ÎûòÏä§
        function getTeamClass(team) {
            const teamMap = {
                '1ÌååÌä∏': 'team-part1',
                '2ÌååÌä∏': 'team-part2',
                '3ÌååÌä∏': 'team-part3',
                '4ÌååÌä∏': 'team-part4',
                '5ÌååÌä∏': 'team-part5'
            };
            return teamMap[team] || '';
        }
        
        // Ïä§ÏºÄÏ§Ñ ÌëúÏãú
        function displaySchedule(schedule) {
            document.getElementById('emptyState').style.display = 'none';
            document.getElementById('scheduleContent').style.display = 'block';
            
            // ÎÇ†Ïßú ÌëúÏãú
            const date = new Date(document.getElementById('scheduleDate').value || new Date());
            const days = ['ÏùºÏöîÏùº', 'ÏõîÏöîÏùº', 'ÌôîÏöîÏùº', 'ÏàòÏöîÏùº', 'Î™©ÏöîÏùº', 'Í∏àÏöîÏùº', 'ÌÜ†ÏöîÏùº'];
            const dateStr = `${date.getFullYear()}ÎÖÑ ${date.getMonth() + 1}Ïõî ${date.getDate()}Ïùº ${days[date.getDay()]}`;
            document.getElementById('scheduleDateDisplay').textContent = dateStr;
            
            // ÌÜµÍ≥Ñ Í≥ÑÏÇ∞
            let totalCount = 0;
            let morningCount = 0;
            let afternoonCount = 0;
            
            // ÏãúÍ∞ÑÌëú ÏÉùÏÑ±
            const container = document.getElementById('scheduleTableContainer');
            container.innerHTML = '';
            
            lunchSlots.forEach(slot => {
                if (schedule[slot] && schedule[slot].length > 0) {
                    const slotDiv = document.createElement('div');
                    slotDiv.className = 'time-slot';
                    
                    const content = document.createElement('div');
                    content.className = 'time-slot-content';
                    
                    const timeLabel = document.createElement('div');
                    timeLabel.className = 'time-label';
                    timeLabel.textContent = slot;
                    
                    const personList = document.createElement('div');
                    personList.className = 'person-list';
                    
                    schedule[slot].forEach(emp => {
                        const badge = document.createElement('span');
                        badge.className = 'person-badge';
                        
                        if (leaders.includes(emp.name)) {
                            badge.className += ' leader-badge';
                            badge.textContent = `${emp.name} (${emp.team})`;
                        } else {
                            badge.className += ' ' + getTeamClass(emp.team);
                            badge.textContent = `${emp.name} (${emp.team})`;
                        }
                        
                        personList.appendChild(badge);
                        
                        totalCount++;
                        if (emp.shift === 'Ïò§Ï†Ñ') morningCount++;
                        else afternoonCount++;
                    });
                    
                    content.appendChild(timeLabel);
                    content.appendChild(personList);
                    slotDiv.appendChild(content);
                    container.appendChild(slotDiv);
                }
            });
            
            // ÌÜµÍ≥Ñ ÏóÖÎç∞Ïù¥Ìä∏
            document.getElementById('totalCount').textContent = totalCount;
            document.getElementById('morningCount').textContent = morningCount;
            document.getElementById('afternoonCount').textContent = afternoonCount;
            
            // ÎÇ¥ Ï†êÏã¨ ÏãúÍ∞Ñ ÏóÖÎç∞Ïù¥Ìä∏
            updateMyLunchTime();
        }
        
        // Î©îÏãúÏßÄ ÌëúÏãú
        function showSuccess(message) {
            const div = document.getElementById('successMessage');
            div.textContent = message;
            div.style.display = 'block';
            setTimeout(() => {
                div.style.display = 'none';
            }, 3000);
        }
        
        function showWarning(message) {
            const div = document.getElementById('warningMessage');
            div.textContent = message;
            div.style.display = 'block';
            setTimeout(() => {
                div.style.display = 'none';
            }, 3000);
        }
        
        // ÌéòÏù¥ÏßÄ ÌÅ¥Î¶≠ Ïãú Í≤ÄÏÉâ Ï†úÏïà Îã´Í∏∞
        document.addEventListener('click', function(event) {
            const searchInput = document.getElementById('specialSearchInput');
            const suggestionsDiv = document.getElementById('searchSuggestions');
            
            if (!searchInput.contains(event.target) && !suggestionsDiv.contains(event.target)) {
                suggestionsDiv.classList.remove('active');
            }
        });
    </script>
</body>
</html>
